# UpMemo v0.1.1 變更日誌

**發布日期**: 2025-10-17

## ✨ 新功能

### 網址自動轉換為超連結
- 自動檢測便利貼中的網址（http:// 或 https://）
- 自動將網址轉換為可點擊的藍色超連結
- 點擊超連結會在預設瀏覽器中開啟
- 延遲轉換機制：停止輸入 1 秒後才轉換，避免干擾輸入

## 🔧 技術改進

### 前端架構重構
- 將 `textarea` 改為 `contenteditable` div，支援富文本顯示
- 實作 `linkifyText()` 函數：自動檢測並轉換 URL 為超連結
- 實作 `extractPlainText()` 函數：從 HTML 提取純文本儲存
- 實作 `handleLinkClick()` 函數：處理超連結點擊事件

### 換行處理優化
- 使用 `<br>` 標籤處理換行，確保換行顯示正確
- 修復按 Enter 鍵跳回頂部的問題
- 修復超連結轉換與換行邏輯的衝突
- 實作游標位置保持機制，避免更新 DOM 時游標跳動

### 依賴更新
- 新增 `@tauri-apps/plugin-shell` 用於開啟外部連結
- 在 Rust 端註冊 shell plugin
- 在 tauri.conf.json 中配置 `shell:allow-open` 權限

## 🐛 修復問題

- 修復 contenteditable 中按 Enter 鍵會跳回頂部的問題
- 修復網址轉換時會影響換行符的問題
- 修復頻繁更新 innerHTML 導致輸入體驗不佳的問題

## 📝 檔案變更

### 新增檔案
- `src/linkify.ts` - 網址轉換為超連結的核心邏輯

### 修改檔案
- `src/index.html` - 將 textarea 改為 contenteditable div
- `src/main.ts` - 整合網址轉換邏輯，優化輸入處理
- `src/styles.css` - 更新樣式以支援超連結顯示
- `src/dom.ts` - 更新 DOM 元素引用
- `src/font.ts` - 適配新的 noteDisplay 元素
- `src/history.ts` - 適配新的 noteDisplay 元素
- `src/theme.ts` - 適配新的 noteDisplay 元素
- `package.json` - 新增 @tauri-apps/plugin-shell
- `src-tauri/Cargo.toml` - 新增 tauri-plugin-shell
- `src-tauri/src/main.rs` - 註冊 shell plugin
- `src-tauri/tauri.conf.json` - 新增 shell 權限

## 🚀 未來計劃

- 多便利貼支援（規劃中）
- 每個便利貼獨立視窗
- 便利貼位置記憶
- 啟動時恢復所有便利貼

---

**完整變更**: [v0.1.0...v0.1.1](https://github.com/lsyuan36/upmemo/compare/v0.1.0...v0.1.1)
---

## 圖片功能（新增與優化）

### 新增
- 拖放插入圖片：`note-display` 支援 `dragenter/dragover/dragleave/drop`，可直接將本機影像檔拖入插入游標處（單檔上限 10MB）。
- 圖片選取與刪除：點擊圖片容器顯示選取框，按 `Delete`/`Backspace` 可刪除。

### 優化
- 貼上/拖放圖片壓縮：
  - JPEG 以品質 0.85 匯出。
  - PNG 保留透明並將最長邊縮放至 1600px（視原始尺寸自動縮放）。
  - GIF 保留原始資料（避免破壞動畫）。
- 圖片縮放事件效能：全域 `mousemove`/`mouseup` 僅在拖曳期間掛載，結束即移除，降低事件成本。
- 序列化安全：保存/重載時會移除圖片容器上的 `selected` 樣式類別，避免樣式殘留。

### 桌面設定
- 啟用 Tauri 視窗拖放：`tauri.conf.json` 將 `dragDropEnabled` 設為 `true`。

### 變更檔案
- `src/image.ts` — 新增拖放處理、選取刪除、影像壓縮與縮放事件優化。
- `src/styles.css` — 新增 `.image-container.selected` 樣式（選取外框）。
- `src/linkify.ts` — 序列化時移除 `selected` 類別，避免保存樣式殘留。
- `src-tauri/tauri.conf.json` — 啟用視窗拖放。

### 已知限制
- 圖片仍以 Data URL 內嵌；雖有壓縮與縮放，若大量插入仍可能影響載入時間與儲存大小。
- 單檔大小限制：貼上 5MB、拖放 10MB；超過會提示。
